#+TITLE: Deployment
#+Author: VLEAD
#+Date: [2016-05-27 Fri]
#+PROPERTY: results output
#+PROPERTY: exports code
#+SETUPFILE: ./org-templates/level-0.org
#+options: ^:nil

* Manual Deployment of =web-app-short-course= Application
** Log In to base4 Machine
   Use your LDAP Account credentials to login:
   #+BEGIN_EXAMPLE
   ssh <USERNAME>@10.4.12.24
   sudo su -
   #+END_EXAMPLE
** creation of container
   Before creating the container, check for the available free ip using following command:
   #+BEGIN_EXAMPLE
   ping 10.4.16.206
   #+END_EXAMPLE
   If it is not used by any other container, then use this ip to create new container

   #+BEGIN_SRC 
   vzctl create <CTID> --ostemplate <OS-TEMPLATE> --ipadd <IP-ADDRESS> --diskspace 10G:15.0G --hostname <HOST-NAME>
   vzctl start <CTID>
   vzctl enter <CTID>
   #+END_SRC
   *Example:*
   #+BEGIN_EXAMPLE
   vzctl create 16206 --ostemplate ubuntu-12.04-custom-x86_64 --ipadd 10.4.15.206 --diskspace 10G:15.0G --hostname web-app.vlabs.ac.in
   vzctl start 16206
   vzctl enter 16206
   #+END_EXAMPLE
** setting up proxy
   #+BEGIN_EXAMPLE
   export http_proxy="http://proxy.iiit.ac.in:8080"
   export https_proxy="http://proxy.iiit.ac.in:8080"
   #+END_EXAMPLE

** Setting up proxy in =apt.conf= 
   Update the =/etc/apt/apt.conf= file with the following proxy details:
   #+BEGIN_EXAMPLE
   echo 'Acquire::http::Proxy "http://proxy.iiit.ac.in:8080";' >> /etc/apt/apt.conf
   echo 'Acquire::https::Proxy "http://proxy.iiit.ac.in:8080";' >> /etc/apt/apt.conf
   #+END_EXAMPLE
** Installing emacs
   #+BEGIN_EXAMPLE
   sudo apt-get update
   sudo apt-get install -y emacs
   #+END_EXAMPLE
** Installing Org 8.2.10
   #+BEGIN_EXAMPLE
   mkdir -p ~/emacs/lisp
   cd ~/emacs/lisp
   wget http://orgmode.org/org-8.2.10.tar.gz
   tar zxvf org-8.2.10.tar.gz
   #+END_EXAMPLE

** cloning the repository
   #+BEGIN_EXAMPLE
   cd ~
   git clone https://github.com/vlead/web-app-short-course.git
   cd web-app-short-course
   git checkout deployment
   #+END_EXAMPLE
** build
   #+BEGIN_EXAMPLE
   make
   #+END_EXAMPLE
** Post build steps 
   #+BEGIN_EXAMPLE
   cp -R build/code/* /var/www/
   chmod -R 755 /var/www
   mkdir /var/www/logs
   chmod -R 777 /var/www/logs
   #+END_EXAMPLE

** installing dependencies and setting up the database
   #+BEGIN_EXAMPLE
   bash /var/www/setup.sh
   python /var/www/setup.py install
   bash /var/www/configure.sh
   python /var/www/db_setup.py
   #+END_EXAMPLE
** Update =config.py= file
   update the =APP_URL= value with the ip-address and port number to run the application.
   #+BEGIN_EXAMPLE
   emacs -nw /var/www/src/config.py 
   APP_URL = "<ip-address>"
   #+END_EXAMPLE
** Restart Apache service
   #+BEGIN_EXAMPLE
   service apache2 restart
   #+END_EXAMPLE
** Accessing web application through browser
   #+BEGIN_EXAMPLE
   http://<ipaddress>
   #+END_EXAMPLE

